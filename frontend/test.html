<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCRTSibyl Credit Score Gauge - D3 Version</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            background-color: #0B0E14;
            color: #ffffff;
        }

        .container {
            max-width: 1000px; /* Increased max-width */
            margin: 40px auto;
            padding: 20px;
        }

        .title {
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 50px;
        }

        .title-colored {
            color: #8B5CF6;
        }

        #gauge-container {
            position: relative;
            width: 100%;
        }

        .color-bar {
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, 
                #FF3A49 0%, 
                #FF5A5A 14.28%, 
                #F57FE8 28.57%, 
                #B37CFF 42.85%, 
                #5E7BF6 57.14%, 
                #48A3E8 71.42%, 
                #45C7B3 85.71%, 
                #48E88D 100%
            );
            border-radius: 4px;
            margin-top: 20px;
        }

        .score-numbers {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .score-numbers span:nth-child(1) { color: #FF3A49; }
        .score-numbers span:nth-child(2) { color: #FF5A5A; }
        .score-numbers span:nth-child(3) { color: #F57FE8; }
        .score-numbers span:nth-child(4) { color: #B37CFF; }
        .score-numbers span:nth-child(5) { color: #5E7BF6; }
        .score-numbers span:nth-child(6) { color: #48A3E8; }
        .score-numbers span:nth-child(7) { color: #45C7B3; }
        .score-numbers span:nth-child(8) { color: #48E88D; }

        .value-ranges {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: #8B93A7;
            font-size: 14px;
        }

        .gauge-label {
            font-weight: bold;
            text-shadow: 0px 0px 5px rgba(0,0,0,0.9);
            font-size: 20px !important; /* Force larger size */
            paint-order: stroke;
            stroke: rgba(0,0,0,0.8);
            stroke-width: 2px;
        }

        .score-bubble {
            font-weight: bold;
            font-size: 16px !important; /* Force larger size */
        }
        
        /* Add a static position class to prevent elements from moving */
        .fixed-element {
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">
            <span class="title-colored">SCRTSibyl</span> Credit Score Ranges
        </h1>
        
        <div id="gauge-container"></div>
        
        <div class="color-bar"></div>
        <div class="score-numbers">
            <span>300</span>
            <span>500</span>
            <span>560</span>
            <span>650</span>
            <span>740</span>
            <span>800</span>
            <span>870</span>
            <span>900</span>
        </div>
        <div class="value-ranges">
            <span>$0</span>
            <span>$0 - 1K</span>
            <span>$1K - 5K</span>
            <span>$5K - 10K</span>
            <span>$10K - 15K</span>
            <span>$15K - 20K</span>
            <span>$20K - 25K+</span>
        </div>
    </div>

    <script>
        class D3CreditScoreGauge {
            constructor(options = {}) {
                this.containerId = options.containerId || 'gauge-container';
                this.width = options.width || 900; // Increased default width
                this.height = options.height || 500; // Increased default height
                this.margin = options.margin || { top: 60, right: 30, bottom: 60, left: 30 }; // Increased top margin
                this.minScore = options.minScore || 300;
                this.maxScore = options.maxScore || 900;
                this.currentScore = options.currentScore || 650;
                this.categories = [
                    { name: "VERY POOR", min: 300, max: 499 },
                    { name: "POOR", min: 500, max: 559 },
                    { name: "FAIR", min: 560, max: 649 },
                    { name: "GOOD", min: 650, max: 739 },
                    { name: "VERY GOOD", min: 740, max: 799 },
                    { name: "EXCELLENT", min: 800, max: 869 },
                    { name: "EXCEPTIONAL", min: 870, max: 900 }
                ];
                this.scoreLabels = [300, 500, 560, 650, 740, 800, 870, 900];
                this.colorScale = d3.interpolateRgbBasis([
                    "#FF3A49", "#FF5A5A", "#F57FE8", "#B37CFF", 
                    "#5E7BF6", "#48A3E8", "#45C7B3", "#48E88D"
                ]);
                
                this.initialize();
            }
            
            initialize() {
                // Create main container SVG with increased dimensions
                const svgContainer = d3.select(`#${this.containerId}`)
                    .append("svg")
                    .attr("width", this.width)
                    .attr("height", this.height)
                    .style("display", "block")
                    .style("margin", "0 auto");
                
                // Create a fixed group for all static elements (won't move with needle)
                const fixedGroup = svgContainer.append("g")
                    .attr("class", "fixed-elements")
                    .attr("transform", `translate(${this.width / 2},${this.height - this.margin.bottom})`);
                
                // Create separate needle group that will be animated
                const needleGroup = svgContainer.append("g")
                    .attr("class", "needle-group")
                    .attr("transform", `translate(${this.width / 2},${this.height - this.margin.bottom})`);
                
                // Define arc generator with increased thickness
                const arcRadius = Math.min(this.width, this.height * 1.8) / 2 - this.margin.top; // Increased radius
                const arc = d3.arc()
                    .innerRadius(arcRadius - 90) // Increased thickness from 60 to 90
                    .outerRadius(arcRadius)
                    .startAngle(-Math.PI / 2)
                    .endAngle(Math.PI / 2);
                
                // Create linear gradient
                const gradient = fixedGroup.append("defs")
                    .append("linearGradient")
                    .attr("id", "gauge-gradient")
                    .attr("x1", "0%")
                    .attr("y1", "0%")
                    .attr("x2", "100%")
                    .attr("y2", "0%");
                
                // Add color stops to gradient
                gradient.append("stop")
                    .attr("offset", "0%")
                    .attr("stop-color", "#FF3A49");
                    
                gradient.append("stop")
                    .attr("offset", "14.28%")
                    .attr("stop-color", "#FF5A5A");
                    
                gradient.append("stop")
                    .attr("offset", "28.57%")
                    .attr("stop-color", "#F57FE8");
                    
                gradient.append("stop")
                    .attr("offset", "42.85%")
                    .attr("stop-color", "#B37CFF");
                    
                gradient.append("stop")
                    .attr("offset", "57.14%")
                    .attr("stop-color", "#5E7BF6");
                    
                gradient.append("stop")
                    .attr("offset", "71.42%")
                    .attr("stop-color", "#48A3E8");
                    
                gradient.append("stop")
                    .attr("offset", "85.71%")
                    .attr("stop-color", "#45C7B3");
                    
                gradient.append("stop")
                    .attr("offset", "100%")
                    .attr("stop-color", "#48E88D");
                
                // Draw background arc with gradient
                fixedGroup.append("path")
                    .datum({ startAngle: -Math.PI / 2, endAngle: Math.PI / 2 })
                    .attr("d", arc)
                    .style("fill", "url(#gauge-gradient)");
                
                // Add score labels
                const scoreScale = d3.scaleLinear()
                    .domain([this.minScore, this.maxScore])
                    .range([-Math.PI / 2, Math.PI / 2]);
                
                // Add category labels in FIXED positions on the gauge
                this.categories.forEach((category) => {
                    const midScore = (category.min + category.max) / 2;
                    const angle = scoreScale(midScore);
                    
                    // Position category labels inside the gauge arc with larger offset
                    // This ensures they are properly fixed to the arc
                    const [x, y] = this.getCoordinates(angle, arcRadius - 45);
                    
                    fixedGroup.append("text")
                        .attr("class", "gauge-label fixed-element")
                        .attr("x", x)
                        .attr("y", y)
                        .attr("text-anchor", "middle")
                        .attr("fill", "white")
                        .attr("font-size", "20px") // Increased font size
                        .attr("font-weight", "bold")
                        .text(category.name);
                });
                
                // Score bubbles with increased size in FIXED positions
                this.scoreLabels.forEach(score => {
                    const angle = scoreScale(score);
                    const [x, y] = this.getCoordinates(angle, arcRadius + 40); // Moved farther out
                    
                    // Determine label color based on position
                    let labelColor;
                    if (score === 300) labelColor = "#FF3A49";
                    else if (score === 500) labelColor = "#FF5A5A";
                    else if (score === 560) labelColor = "#F57FE8";
                    else if (score === 650) labelColor = "#B37CFF";
                    else if (score === 740) labelColor = "#5E7BF6";
                    else if (score === 800) labelColor = "#48A3E8";
                    else if (score === 870) labelColor = "#45C7B3";
                    else if (score === 900) labelColor = "#48E88D";
                    
                    // Add bubbles to fixed group, not needle group
                    fixedGroup.append("circle")
                        .attr("class", "fixed-element")
                        .attr("cx", x)
                        .attr("cy", y)
                        .attr("r", 32) // Increased size from 24 to 32
                        .attr("fill", labelColor);
                    
                    fixedGroup.append("text")
                        .attr("class", "score-bubble fixed-element")
                        .attr("x", x)
                        .attr("y", y)
                        .attr("dy", "0.35em")
                        .attr("text-anchor", "middle")
                        .attr("fill", "white")
                        .attr("font-size", "16px") // Increased font size
                        .attr("font-weight", "bold")
                        .text(score);
                });
                
                // Create needle with larger dimensions
                this.needleGroup = needleGroup;
                
                // Add needle line with increased size
                this.needle = this.needleGroup.append("line")
                    .attr("x1", 0)
                    .attr("y1", 0)
                    .attr("x2", 0)
                    .attr("y2", -arcRadius + 20) // Longer needle
                    .attr("stroke", "white")
                    .attr("stroke-width", 10) // Thicker needle (was 6)
                    .attr("stroke-linecap", "round");
                
                // Add glow filter for the needle
                const defs = this.needleGroup.append("defs");
                const filter = defs.append("filter")
                    .attr("id", "glow")
                    .attr("x", "-50%")
                    .attr("y", "-50%")
                    .attr("width", "200%")
                    .attr("height", "200%");
                    
                filter.append("feGaussianBlur")
                    .attr("stdDeviation", "3")
                    .attr("result", "blur");
                    
                filter.append("feComposite")
                    .attr("in", "SourceGraphic")
                    .attr("in2", "blur")
                    .attr("operator", "over");
                
                // Add needle center circle with increased size
                this.needleGroup.append("circle")
                    .attr("cx", 0)
                    .attr("cy", 0)
                    .attr("r", 25) // Bigger circle (was 15)
                    .attr("fill", "white")
                    .attr("filter", "url(#glow)");
                
                // Add inner circle for style
                this.needleGroup.append("circle")
                    .attr("cx", 0)
                    .attr("cy", 0)
                    .attr("r", 18) // Bigger inner circle (was 10)
                    .attr("fill", "#0B0E14");
                
                // Display current score value in a large, fixed position
                this.scoreText = fixedGroup.append("text")
                    .attr("class", "fixed-element")
                    .attr("x", 0)
                    .attr("y", -arcRadius / 4)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "60px") // Much larger font
                    .attr("font-weight", "bold")
                    .attr("fill", "white")
                    .text(this.currentScore);
                
                // Set initial needle position
                this.setScore(this.currentScore);
            }
            
            getCoordinates(angle, radius) {
                return [
                    Math.cos(angle) * radius,
                    Math.sin(angle) * radius
                ];
            }
            
            setScore(score) {
                this.currentScore = Math.max(this.minScore, Math.min(score, this.maxScore));
                const scoreRange = this.maxScore - this.minScore;
                const percentage = (this.currentScore - this.minScore) / scoreRange;
                const angle = -90 + (percentage * 180);
                
                // Update score text
                this.scoreText.text(this.currentScore);
                
                // Animate needle only (not the text or bubbles)
                this.needleGroup.transition()
                    .duration(1500)
                    .ease(d3.easeBounceOut)
                    .attrTween("transform", () => {
                        const currentAngle = this.currentAngle || -90;
                        this.currentAngle = angle;
                        const centerX = this.width / 2;
                        const centerY = this.height - this.margin.bottom;
                        return d3.interpolate(
                            `translate(${centerX},${centerY}) rotate(${currentAngle})`,
                            `translate(${centerX},${centerY}) rotate(${angle})`
                        );
                    });
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const gauge = new D3CreditScoreGauge({
                containerId: 'gauge-container',
                currentScore: 650,
                width: window.innerWidth > 1000 ? 900 : window.innerWidth - 50, // Larger default size
                height: 450 // Increased height
            });
            
            // Example: Set different score after a delay
            setTimeout(() => {
                gauge.setScore(650);
            }, 1000);
            
            // For testing/demo purposes - allow changing the score
            window.setGaugeScore = (score) => {
                gauge.setScore(score);
            };
            
            // Make gauge responsive
            window.addEventListener('resize', () => {
                document.getElementById('gauge-container').innerHTML = '';
                const newGauge = new D3CreditScoreGauge({
                    containerId: 'gauge-container',
                    currentScore: gauge.currentScore,
                    width: window.innerWidth > 1000 ? 900 : window.innerWidth - 50,
                    height: 450
                });
            });
        });
    </script>
</body>
</html>