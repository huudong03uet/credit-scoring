<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Score Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            padding: 20px;
            background: var(--bg-primary);
        }
        .demo-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .demo-header {
            text-align: center;
            margin-bottom: 40px;
            color: var(--text-primary);
        }
        .demo-header h1 {
            font-size: 36px;
            margin-bottom: 16px;
        }
        .demo-header p {
            color: var(--text-secondary);
            font-size: 18px;
        }
        .test-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
        }
        .input-section {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            align-items: center;
        }
        .wallet-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: monospace;
        }
        .test-btn {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .test-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        .test-btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
        }
        .demo-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .demo-btn {
            background: var(--accent-green);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        .demo-btn:hover {
            background: #16a34a;
        }
        .api-status {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }
        .api-status.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
        }
        .api-status.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1><span style="color: var(--accent-blue);"></span> Credit Score Calculator</h1>
            <p>Calculate and explain wallet credit scores with network analysis</p>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-calculator"></i> Calculate Credit Score</h3>
            <p>Enter a wallet address to calculate its credit score and get detailed analysis:</p>
            
            <div class="api-status" id="api-status">
                <!-- Status messages will appear here -->
            </div>
            
            <div class="input-section">
                <input 
                    type="text" 
                    id="wallet-input" 
                    class="wallet-input"
                    placeholder="Enter wallet address (0x...)"
                    value="0x57ef012861c4937a76b5d6061be800199a2b9100"
                />
                <button id="calculate-btn" class="test-btn">
                    <i class="fas fa-calculator"></i>
                    Calculate Score
                </button>
            </div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="setDemoWallet('0x57ef012861c4937a76b5d6061be800199a2b9100')">
                    <i class="fas fa-play"></i>
                    Demo Wallet 1
                </button>
                <button class="demo-btn" onclick="setDemoWallet('0xd0f10060e182c8eb8fa0a4fa4d77adf0e0475261')">
                    <i class="fas fa-play"></i>
                    Demo Wallet 2
                </button>
                <button class="demo-btn" onclick="clearResults()">
                    <i class="fas fa-trash"></i>
                    Clear Results
                </button>
            </div>
        </div>

        <!-- Results will be displayed here -->
        <div id="import-results" class="import-results" style="display: none;">
            <!-- Credit score results will be populated here -->
        </div>
    </div>

    <script type="module">
        import { fetchCreditScoreExplanation } from './js/services/apiService.js';
        import { CreditScoreDisplay } from './js/components/CreditScoreDisplay.js';

        const display = new CreditScoreDisplay();
        const walletInput = document.getElementById('wallet-input');
        const calculateBtn = document.getElementById('calculate-btn');
        const statusDiv = document.getElementById('api-status');

        function showStatus(message, type = 'success') {
            statusDiv.textContent = message;
            statusDiv.className = `api-status ${type}`;
            statusDiv.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }

        async function calculateScore() {
            const walletAddress = walletInput.value.trim();
            
            if (!walletAddress) {
                showStatus('Please enter a wallet address', 'error');
                return;
            }

            if (!/^0x[a-fA-F0-9]{40}$/.test(walletAddress)) {
                showStatus('Please enter a valid wallet address', 'error');
                return;
            }

            calculateBtn.disabled = true;
            calculateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Calculating...';
            
            try {
                // Create wallet_id in the format expected by the API
                const walletId = `0x1_${walletAddress}`;
                
                showStatus(`Calculating score for wallet: ${walletAddress}...`, 'success');
                
                const scoreData = await fetchCreditScoreExplanation(walletId);
                console.log('Credit score response:', scoreData);
                
                display.displayCreditScoreResults(scoreData);
                showStatus('Credit score calculated successfully!', 'success');
                
            } catch (error) {
                console.error('Error calculating score:', error);
                showStatus(`Error: ${error.message}`, 'error');
                
                // Show demo data as fallback
                const demoData = {
                    status: "success",
                    explanation: "Credit score 679.39 là trung bình. Wallet có mối quan hệ tích cực với người cho vay uy tín, nhưng bị ảnh hưởng tiêu cực bởi hạng mức tín dụng thấp và thời gian sử dụng ví ngắn. Cần cải thiện hạng mức tín dụng và duy trì hoạt động giao dịch lâu dài để nâng cao credit score.",
                    processing_time: "1.2s",
                    tokens_used: 150,
                    error_message: null,
                    nodes: [
                        {
                            numberOfDailyActiveUsers: 4,
                            address: "0x158079ee67fce2f58472a96584a73c7ab9ac95c1",
                            chainId: "0x1",
                            numberOfDailyCalls: 4,
                            id: "0x1_0x158079ee67fce2f58472a96584a73c7ab9ac95c1",
                            tags: ["token", "compound"]
                        },
                        {
                            numberOfDailyActiveUsers: 9,
                            address: "0xb3319f5d18bc0d84dd1b4825dcde5d5f7266d407",
                            chainId: "0x1",
                            numberOfDailyCalls: 9,
                            id: "0x1_0xb3319f5d18bc0d84dd1b4825dcde5d5f7266d407",
                            tags: ["compound-0x", "token"]
                        },
                        {
                            numberOfDailyActiveUsers: 5,
                            address: "0xf5dce57282a584d2746faf1593d3121fcac444dc",
                            chainId: "0x1",
                            numberOfDailyCalls: 5,
                            id: "0x1_0xf5dce57282a584d2746faf1593d3121fcac444dc",
                            tags: ["token", "compound"]
                        }
                    ],
                    edges: [
                        { amount: 22.1377, _id: "8012768_93", timestamp: 1561272103 },
                        { amount: 15663, _id: "7906376_112", timestamp: 1559833296 },
                        { amount: 9055, _id: "7913685_76", timestamp: 1559932816 },
                        { amount: 5088, _id: "7927374_22", timestamp: 1560118947 },
                        { amount: 3420, _id: "7930640_71", timestamp: 1560162133 },
                        { amount: 4847.7, _id: "7944753_72", timestamp: 1560353465 },
                        { amount: 6297.7812, _id: "7959008_120", timestamp: 1560545663 }
                    ],
                    score: 679.3870372065838
                };
                
                display.displayCreditScoreResults(demoData);
                showStatus('Showing demo data due to API error', 'error');
                
            } finally {
                calculateBtn.disabled = false;
                calculateBtn.innerHTML = '<i class="fas fa-calculator"></i> Calculate Score';
            }
        }

        // Event listeners
        calculateBtn.addEventListener('click', calculateScore);
        walletInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') calculateScore();
        });

        // Global functions for demo buttons
        window.setDemoWallet = function(address) {
            walletInput.value = address;
        };

        window.clearResults = function() {
            document.getElementById('import-results').style.display = 'none';
            statusDiv.style.display = 'none';
            display.cleanup();
        };
    </script>
</body>
</html>
